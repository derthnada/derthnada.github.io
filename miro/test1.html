<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://miro.com/app/static/sdk.1.1.js"></script>
    <script>
	function roll() {
	let retval = "";
	let t = 0;
	for (let i=0; i< 4; i++){
		let x = Math.floor(Math.random() * 3 - 1);
		t += x;
		retval += " " + x;
	}
	return retval += "\n" + t;
	}

	async function doRoll() {
		const waitOneSec = () => new Promise(r => setTimeout(r, 2000));
		let resp = await miro.board.widgets.create({type:'sticker', text: roll()});
		let sticker = resp[0];
		await miro.board.viewport.zoomToObject(sticker);
		await waitOneSec(); // timeout only for demo purpose
		await miro.board.widgets.deleteById(sticker.id); // delete sticker
	}

    miro.onReady(() => {
      miro.initialize({
        extensionPoints: {
          toolbar: {
            title: 'Roll 4df',
            toolbarSvgIcon: '<rect fill="none" stroke="blue" ry="3" stroke-width="3" width="20" height="20" x="2" y="2"></rect>',
            librarySvgIcon: '<rect fill="none" stroke="blue" ry="3" stroke-width="3" width="20" height="20" x="2" y="2"></rect>',
            onClick: doRoll
          }
        }
      })
    })
    </script>
</head>
</html>
